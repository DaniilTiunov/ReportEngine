<Window
    x:Class="ReportEngine.App.Views.Windows.FormedDrainagesView"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    Title="Создание и редактирование дренажей"
    FontFamily="Bahnschrift"
    FontSize="14"
    Background="{DynamicResource PrimaryColor}"
    Foreground="{DynamicResource PrimaryForeground}"
    WindowStyle="None"
    ResizeMode="CanResize">

    <WindowChrome.WindowChrome>
        <WindowChrome
        CaptionHeight="0"
        CornerRadius="0"
        GlassFrameThickness="0" />
    </WindowChrome.WindowChrome>

    <Border Style="{DynamicResource WindowBorder}">
        <DockPanel>
            <Border
        x:Name="FormedFrameWindowTitle"
        Height="34"
        Background="#2D2D30"
        DockPanel.Dock="Top"
        MouseLeftButtonDown="Window_MouseLeftButtonDown">

                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>

                    <StackPanel
                Margin="10,0,0,0"
                VerticalAlignment="Center"
                Orientation="Horizontal">
                        <Image
                    Width="18"
                    Height="18"
                    Margin="0,0,8,0"
                    Source="/Resources/Icons/estimate_cost_icon_213382.ico" />
                        <TextBlock
                    VerticalAlignment="Center"
                    FontSize="14"
                    Foreground="White"
                    Text="{Binding Title, RelativeSource={RelativeSource AncestorType=Window}}" />
                    </StackPanel>

                    <StackPanel
                Grid.Column="1"
                VerticalAlignment="Center"
                Orientation="Horizontal">
                        <Button
                    x:Name="MinimizeButton"
                    Width="40"
                    Height="30"
                    Click="MinimizeButton_Click"
                    FontSize="16"
                    ToolTip="Свернуть">
                            ─
                        </Button>
                        <Button
                    x:Name="MaxRestoreButton"
                    Width="40"
                    Height="30"
                    Margin="10,0,0,0"
                    Click="MaxRestoreButton_Click"
                    FontSize="16"
                    ToolTip="Развернуть">
                            ▢
                        </Button>
                        <Button
                    x:Name="CloseButton"
                    Width="40"
                    Height="30"
                    Margin="10,0,10,0"
                    Click="CloseButton_Click"
                    FontSize="16"
                    ToolTip="Закрыть">
                            ✕
                        </Button>
                    </StackPanel>
                </Grid>
            </Border>

            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="2*" />
                    <ColumnDefinition Width="1*" />
                </Grid.ColumnDefinitions>

                <!--  Левая часть: Список дренажей и параметры  -->
                <Grid Grid.Column="0">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="*" />
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                    </Grid.RowDefinitions>

                    <!--  Список дренажей  -->
                    <GroupBox
                    Grid.Row="0"
                    Margin="10"
                    Header="Список дренажей">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="*" />
                            </Grid.ColumnDefinitions>
                            <DataGrid
                            Grid.Column="0"
                            Margin="5"
                            AutoGenerateColumns="False"
                            CanUserAddRows="False"
                            ItemsSource="{Binding FormedDrainagesModel.AllFormedDrainage}"
                            SelectedItem="{Binding FormedDrainagesModel.SelectedFormedDrainage, Mode=TwoWay}">
                                <DataGrid.Columns>
                                    <DataGridTextColumn Binding="{Binding Name}" Header="Наименование" />
                                </DataGrid.Columns>
                            </DataGrid>
                            <GroupBox
                            Grid.Column="1"
                            Margin="5"
                            Header="Назначения дренажа">
                                <StackPanel>
                                    <DataGrid
                                    Margin="5"
                                    AutoGenerateColumns="False"
                                    CanUserAddRows="False"
                                    ItemsSource="{Binding FormedDrainagesModel.Purposes}"
                                    SelectedItem="{Binding FormedDrainagesModel.SelectedPurpose, Mode=TwoWay}">
                                        <DataGrid.Columns>
                                            <DataGridTextColumn
                                            Binding="{Binding Purpose, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                            Header="Назначение" />
                                            <DataGridTextColumn
                                            Binding="{Binding Material, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                            Header="Материал" />
                                            <DataGridTextColumn
                                            Binding="{Binding Quantity, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                            Header="Длина (м)" />
                                        </DataGrid.Columns>
                                    </DataGrid>
                                    <StackPanel HorizontalAlignment="Right" Orientation="Horizontal">
                                        <Button
                                        Margin="5"
                                        Command="{Binding AddPurposeCommand}"
                                        Content="Добавить назначение" />
                                        <Button
                                        Margin="5"
                                        Command="{Binding DeletePurposeCommand}"
                                        Content="Удалить назначение" />
                                    </StackPanel>
                                </StackPanel>
                            </GroupBox>
                        </Grid>
                    </GroupBox>

                    <!--  Добавление нового дренажа  -->
                    <GroupBox
                    Grid.Row="1"
                    Margin="10"
                    Header="Добавление нового дренажа">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto" />
                            </Grid.RowDefinitions>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto" />
                                <ColumnDefinition Width="*" />
                            </Grid.ColumnDefinitions>
                            <TextBlock
                            Grid.Row="0"
                            Grid.Column="0"
                            Margin="5"
                            VerticalAlignment="Center">
                            Наименование:
                            </TextBlock>
                            <TextBox
                            Grid.Row="0"
                            Grid.Column="1"
                            Margin="5"
                            Text="{Binding FormedDrainagesModel.NewFormedDrainage.Name, Mode=TwoWay}" />
                        </Grid>
                    </GroupBox>

                    <!--  Редактирование выбранного дренажа  -->
                    <GroupBox
                    Grid.Row="2"
                    Margin="10"
                    Header="Редактирование выбранного дренажа">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto" />
                            </Grid.RowDefinitions>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto" />
                                <ColumnDefinition Width="*" />
                            </Grid.ColumnDefinitions>
                            <TextBlock
                            Grid.Row="0"
                            Grid.Column="0"
                            Margin="5"
                            VerticalAlignment="Center">
                            Наименование:
                            </TextBlock>
                            <TextBox
                            Grid.Row="0"
                            Grid.Column="1"
                            Margin="5"
                            Text="{Binding FormedDrainagesModel.SelectedFormedDrainage.Name, Mode=TwoWay}" />
                        </Grid>
                    </GroupBox>

                    <!--  Кнопки управления  -->
                    <StackPanel
                    Grid.Row="3"
                    Margin="10"
                    HorizontalAlignment="Center"
                    Orientation="Horizontal">
                        <Button
                        Margin="5"
                        Command="{Binding AddFormedDrainageCommand}"
                        Content="Добавить дренаж" />
                        <Button
                        Margin="5"
                        Command="{Binding SaveChangesCommand}"
                        Content="Сохранить изменения" />
                        <Button
                        Margin="5"
                        Command="{Binding DeleteFormedDrainageCommand}"
                        Content="Удалить выбранный дренаж" />
                    </StackPanel>
                </Grid>

                <!--  Правая часть: Справочник дренажей  -->
                <Grid Grid.Column="1">
                    <TabControl Margin="10">
                        <TabItem Header="Исходный дренаж">
                            <StackPanel>
                                <DataGrid
                                Height="294"
                                AutoGenerateColumns="False"
                                CanUserAddRows="False"
                                ItemsSource="{Binding FormedDrainagesModel.DrainageDetails}"
                                SelectedItem="{Binding FormedDrainagesModel.SelectedDrainageDetail, Mode=TwoWay}">
                                    <DataGrid.Columns>
                                        <DataGridTextColumn Binding="{Binding Name}" Header="Наименование" />
                                        <DataGridTextColumn Binding="{Binding Cost}" Header="Цена" />
                                        <DataGridTextColumn Binding="{Binding Measure}" Header="Ед. изм." />
                                    </DataGrid.Columns>
                                </DataGrid>
                                <Button
                                Margin="5"
                                Command="{Binding InsertMaterialCommand}"
                                Content="Вставить материал" />
                            </StackPanel>
                        </TabItem>
                    </TabControl>
                </Grid>
            </Grid>
        </DockPanel>
    </Border>
</Window>