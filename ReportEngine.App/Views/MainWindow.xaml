<Window
    x:Class="ReportEngine.App.MainWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:converters="clr-namespace:ReportEngine.App.Display"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:session="clr-namespace:ReportEngine.App.Services.Core"
    Title="Стенды КИП"
    Background="{DynamicResource PrimaryColor}"
    FontFamily="Bahnschrift"
    Foreground="{DynamicResource PrimaryForeground}"
    ResizeMode="CanResize"
    WindowStartupLocation="CenterScreen"
    WindowState="Normal"
    WindowStyle="None"
    mc:Ignorable="d">

    <WindowChrome.WindowChrome>
        <WindowChrome
            CaptionHeight="0"
            CornerRadius="0"
            GlassFrameThickness="0" />
    </WindowChrome.WindowChrome>


    <Window.Resources>
        <ResourceDictionary>
            <Image x:Key="refresh-button.png" Source="/Resources/Images/refresh-button.png" />
            <converters:RoleToVisibilityConverter x:Key="AdminVisibilityConverter" />
            <converters:TranslateUserRole x:Key="TranslateUserRole" />
        </ResourceDictionary>
    </Window.Resources>

    <DockPanel>
        <Border
            x:Name="MainWindowControlTitle"
            Height="34"
            Background="#2D2D30"
            DockPanel.Dock="Top"
            MouseLeftButtonDown="Window_MouseLeftButtonDown">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>

                <StackPanel
                    Margin="10,0,0,0"
                    VerticalAlignment="Center"
                    Orientation="Horizontal">
                    <Image
                        Width="18"
                        Height="18"
                        Margin="0,0,8,0"
                        Source="/Resources/Icons/estimate_cost_icon_213382.ico" />
                    <TextBlock
                        VerticalAlignment="Center"
                        FontSize="14"
                        Foreground="White"
                        Text="{Binding Title, RelativeSource={RelativeSource AncestorType=Window}}" />
                </StackPanel>

                <StackPanel
                    Grid.Column="1"
                    VerticalAlignment="Center"
                    Orientation="Horizontal">
                    <Button
                        x:Name="MinimizeButton"
                        Width="40"
                        Height="30"
                        Click="MinimizeButton_Click"
                        FontSize="16"
                        ToolTip="Свернуть">
                        ─
                    </Button>
                    <Button
                        x:Name="MaxRestoreButton"
                        Width="40"
                        Height="30"
                        Margin="10,0,0,0"
                        Click="MaxRestoreButton_Click"
                        FontSize="16"
                        ToolTip="Развернуть">
                        ▢
                    </Button>
                    <Button
                        x:Name="CloseButton"
                        Width="40"
                        Height="30"
                        Margin="10,0,10,0"
                        Click="CloseButton_Click"
                        FontSize="16"
                        ToolTip="Закрыть">
                        ✕
                    </Button>
                </StackPanel>
            </Grid>
        </Border>
        <Menu
            Height="25"
            DockPanel.Dock="Top"
            FontFamily="Bahnschrift"
            FontSize="14">
            <MenuItem Header="Проект">
                <MenuItem Command="{Binding MainWindowCommandProvider.OpenTreeViewCommand}" Header="Создать новый проект" />
                <MenuItem Command="{Binding MainWindowCommandProvider.OpenMainWindowCommand}" Header="На главный экран" />
                <Separator />
                <MenuItem Command="{Binding MainWindowCommandProvider.OpenSettingsWindow}" Header="Настройки" />
                <Separator />
                <MenuItem Command="{Binding MainWindowCommandProvider.OpenCalculationSettingsWindow}" Header="Настройки расчета" />
            </MenuItem>
            <MenuItem Command="{Binding MainWindowCommandProvider.OpenAuthWindowCommand}" Header="Авторизация" />
            <MenuItem Header="Вид" Tag="ThemeItemChanger">
                <MenuItem
                    Click="ChangeDarkTheme"
                    Header="Тёмная тема"
                    Tag="Dark" />
                <MenuItem
                    Click="StandartTheme"
                    Header="Светлая тема"
                    Tag="Standart" />
                <MenuItem
                    Click="TestTheme"
                    Header="Тестовая тема"
                    Tag="Test" />
            </MenuItem>
            <MenuItem Header="Контакты">
                <MenuItem Command="{Binding MainWindowCommandProvider.OpenAllUsersCommand}" Header="Сотрудники" />
                <Separator />
                <MenuItem Command="{Binding MainWindowCommandProvider.OpenAllCompaniesCommand}" Header="Заказчики" />
            </MenuItem>
            <MenuItem Header="Сортаменты">
                <MenuItem Header="Сортамент труб">
                    <MenuItem Command="{Binding GenericEquipCommandProvider.OpenHeaterPipeCommand}" Header="Жаропрочная сталь" />
                    <MenuItem Command="{Binding GenericEquipCommandProvider.OpenStainlessPipeCommand}" Header="Нержавеющая сталь" />
                    <MenuItem Command="{Binding GenericEquipCommandProvider.OpenCarbonPipeCommand}" Header="Углеродистая сталь" />
                </MenuItem>
                <MenuItem Header="Запорные арматуры">
                    <MenuItem Command="{Binding GenericEquipCommandProvider.OpenHeaterArmatureCommand}" Header="Жаропрочная сталь" />
                    <MenuItem Command="{Binding GenericEquipCommandProvider.OpenStainlessArmatureCommand}" Header="Нержавеющая сталь" />
                    <MenuItem Command="{Binding GenericEquipCommandProvider.OpenCarbonArmatureCommand}" Header="Углеродистая сталь" />
                </MenuItem>
                <MenuItem Header="Тройники и КМЧ">
                    <MenuItem Command="{Binding GenericEquipCommandProvider.OpenHeaterSocketsCommand}" Header="Жаропрочная сталь" />
                    <MenuItem Command="{Binding GenericEquipCommandProvider.OpenStainlessSocketsCommand}" Header="Нержавеющая сталь" />
                    <MenuItem Command="{Binding GenericEquipCommandProvider.OpenCarbonSocketsCommand}" Header="Углеродистая сталь" />
                </MenuItem>
                <Separator />
                <MenuItem Command="{Binding GenericEquipCommandProvider.OpenDrainageCommand}" Header="Дренаж" />
                <Separator />
                <MenuItem Header="Рамные комплектующие">
                    <MenuItem Command="{Binding GenericEquipCommandProvider.OpenFrameDetailsCommand}" Header="Детали рамы" />
                    <MenuItem Command="{Binding GenericEquipCommandProvider.OpenPillarEquipCommand}" Header="Комплектующие для стойки" />
                    <MenuItem Command="{Binding GenericEquipCommandProvider.OpenFrameRollCommand}" Header="Прокат" />
                </MenuItem>
                <Separator />
                <MenuItem Header="Кронштейны">
                    <MenuItem Command="{Binding GenericEquipCommandProvider.OpenBoxesBracesommand}" Header="Крепление клеммных коробок" />
                    <MenuItem Command="{Binding GenericEquipCommandProvider.OpenDrainageBracesCommand}" Header="Крепление дренажа" />
                    <MenuItem Command="{Binding GenericEquipCommandProvider.OpenSensorsBracesCommand}" Header="Крепление датчиков" />
                </MenuItem>
                <Separator />
                <MenuItem Header="Электрические компоненты">
                    <MenuItem Command="{Binding GenericEquipCommandProvider.OpenCabelProductionCommand}" Header="Кабельная продукция" />
                    <MenuItem Command="{Binding GenericEquipCommandProvider.OpenCabelInputCommand}" Header="Кабельные вводы" />
                    <MenuItem Command="{Binding GenericEquipCommandProvider.OpenCabelBoxeCommand}" Header="Клеммные коробки" />
                    <MenuItem Command="{Binding GenericEquipCommandProvider.OpenHeaterCommand}" Header="Обогрев" />
                    <MenuItem Command="{Binding GenericEquipCommandProvider.OpenCabelProtectionCommand}" Header="Средства прокладки и защиты кабеля" />
                </MenuItem>
                <Separator />
                <MenuItem Command="{Binding GenericEquipCommandProvider.OpenOthersCommand}" Header="Прочие" />
                <Separator />
                <MenuItem Command="{Binding GenericEquipCommandProvider.OpenConteinersCommand}" Header="Тара" />
                <Separator />
                <MenuItem Command="{Binding MainWindowCommandProvider.OpenAllSortamentsCommand}" Header="Весь сортамент" />
            </MenuItem>
            <MenuItem Header="Формирование комплектующих">
                <MenuItem Command="{Binding MainWindowCommandProvider.OpenFormedFramesCommand}" Header="Создание и редактировние рам" />
                <Separator />
                <MenuItem Command="{Binding MainWindowCommandProvider.OpenAllObvyazkiCommand}" Header="Обвязки" />
                <Separator />
                <MenuItem Command="{Binding MainWindowCommandProvider.OpenAllDrainagesCommand}" Header="Дренажи" />
            </MenuItem>
            <MenuItem Header="Инструменты">
                <MenuItem Click="ShowCalculator" Header="Калькулятор" />
                <MenuItem Click="ShowNotepad" Header="Блокнот" />
            </MenuItem>
            <MenuItem Header="Справка">
                <MenuItem Click="ShowAboutProgram" Header="О программе" />
                <Separator />
                <MenuItem Header="Открыть справку" />
                <Separator />
                <MenuItem Click="AutoUpdate" Header="Обновить приложение" />
            </MenuItem>
        </Menu>

        <StatusBar
            Height="30"
            DockPanel.Dock="Bottom"
            FontFamily="Bahnschrift">

            <StatusBarItem>
                <TextBlock
                    Margin="5,0,0,0"
                    FontSize="14"
                    Text="Текущий пользователь:" />
            </StatusBarItem>

            <StatusBarItem>
                <TextBlock
                    Margin="5,0,0,0"
                    FontSize="14"
                    FontWeight="Bold"
                    Text="{Binding CurrentUserLogin}" />
            </StatusBarItem>

            <StatusBarItem>
                <TextBlock
                    Margin="5,0,0,0"
                    FontSize="14"
                    Text="Права доступа:" />
            </StatusBarItem>

            <StatusBarItem>
                <TextBlock
                    Margin="5,0,0,0"
                    FontSize="14"
                    FontWeight="Bold"
                    Text="{Binding CurrentUser.SystemRole, Converter={StaticResource TranslateUserRole}}" />
            </StatusBarItem>


            <StatusBarItem HorizontalAlignment="Stretch">
                <Separator Visibility="Hidden" />
            </StatusBarItem>

            <StatusBarItem HorizontalAlignment="Right">
                <StackPanel VerticalAlignment="Center" Orientation="Horizontal">
                    <TextBlock FontSize="14" Text="Статус подключения к серверу:" />
                    <TextBlock
                        Width="191"
                        Margin="5,0,0,0"
                        FontSize="14"
                        Text="{Binding MainWindowModel.ConnectionStatusMessage}" />
                    <Button
                        Height="24"
                        Margin="5,0,5,0"
                        BorderThickness="0"
                        Command="{Binding MainWindowCommandProvider.ChekDbConnectionCommand}"
                        Content="{StaticResource refresh-button.png}" />
                </StackPanel>
            </StatusBarItem>
        </StatusBar>

        <ContentControl x:Name="MainContentControl" Margin="10,0,10,10">
            <DataGrid
                x:Name="MainDataGrid"
                Margin="10,30,10,10"
                AutoGenerateColumns="False"
                ItemsSource="{Binding MainWindowModel.AllProjects}"
                SelectedItem="{Binding MainWindowModel.SelectedProject}"
                SelectionUnit="FullRow">
                <DataGrid.Columns>
                    <DataGridTextColumn
                        Width="*"
                        Binding="{Binding Number}"
                        Header="№п/п" />
                    <DataGridTextColumn
                        Width="*"
                        Binding="{Binding Company}"
                        Header="Заказчик" />
                    <DataGridTextColumn
                        Width="*"
                        Binding="{Binding Object}"
                        Header="Объект" />
                    <DataGridTextColumn
                        Width="*"
                        Binding="{Binding StandCount}"
                        Header="Кол-во стендов" />
                    <DataGridTextColumn
                        Width="*"
                        Binding="{Binding Status}"
                        Header="Статус" />
                    <DataGridTextColumn
                        Width="*"
                        Binding="{Binding StartDate}"
                        Header="Старт проекта" />
                    <DataGridTextColumn
                        Width="*"
                        Binding="{Binding OutOfProduction}"
                        Header="Выход из производства" />
                    <DataGridTextColumn
                        Width="*"
                        Binding="{Binding EndDate}"
                        Header="Дата окончания договора" />
                    <DataGridTextColumn
                        Width="*"
                        Binding="{Binding OrderCustomer}"
                        Header="Заказ покупателя" />
                    <DataGridTextColumn
                        Width="*"
                        Binding="{Binding RequestProduction}"
                        Header="Заявка на производство" />
                    <DataGridTextColumn
                        Width="*"
                        Binding="{Binding HumanCost}"
                        Header="Трудозатраты" />
                    <DataGridTextColumn
                        Width="*"
                        Binding="{Binding Manager}"
                        Header="Руководитель" />
                    <DataGridTextColumn
                        Width="*"
                        Binding="{Binding MarkPlus}"
                        Header="Маркировка +" />
                    <DataGridTextColumn
                        Width="*"
                        Binding="{Binding MarkMinus}"
                        Header="Маркировка -" />
                </DataGrid.Columns>
                <DataGrid.ContextMenu>
                    <ContextMenu>
                        <MenuItem Command="{Binding MainWindowCommandProvider.EditProjectCommand}" Header="Редактировать проект" />
                        <MenuItem Command="{Binding MainWindowCommandProvider.ShowAllProjectsCommand}" Header="Обновить список проектов" />
                        <Separator />
                        <MenuItem Command="{Binding MainWindowCommandProvider.RecalculateProjectCommand}" Header="Переформировать" />
                        <Separator />
                        <MenuItem
                            Command="{Binding MainWindowCommandProvider.DeleteSelectedProjectCommand}"
                            Header="Удалить проект"
                            Visibility="{Binding CurrentUser.SystemRole, RelativeSource={RelativeSource AncestorType=Window}, Converter={StaticResource AdminVisibilityConverter}, ConverterParameter=Admin}" />
                    </ContextMenu>
                </DataGrid.ContextMenu>
            </DataGrid>
        </ContentControl>
    </DockPanel>
</Window>