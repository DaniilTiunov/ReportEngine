<UserControl
    x:Class="ReportEngine.App.Views.Controls.StandObvView"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:converters="clr-namespace:ReportEngine.App.Display"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    FontSize="14"
    
    mc:Ignorable="d">
    <UserControl.Resources>
        <converters:ObvyazkaImagePathConverter x:Key="ObvyazkaImagePathConverter" />
    </UserControl.Resources>

    <Grid Margin="10">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="950" />
            <ColumnDefinition Width="*" />
        </Grid.ColumnDefinitions>

        <!--  Основная форма (слева)  -->
        <Grid Grid.Column="0" Margin="0,0,10,0">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
                <RowDefinition Height="*" />
                <RowDefinition Height="Auto" />
            </Grid.RowDefinitions>

            <!--  Обвязка Section  -->
            <GroupBox
                Grid.Row="0"
                Margin="0,0,0,10"
                Padding="8"
                Header="Обвязка">
                <!--  outer grid: left = form, right = preview (preview вынесен из формы чтобы не растягивать строки)  -->
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="230" />
                    </Grid.ColumnDefinitions>

                    <!--  left: существующая форма (колонки для полей)  -->
                    <Grid Grid.Column="0">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="Auto" />
                        </Grid.RowDefinitions>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto" />
                            <ColumnDefinition Width="220" />
                            <ColumnDefinition Width="60" />
                            <ColumnDefinition Width="60" />
                            <ColumnDefinition Width="125" />
                            <ColumnDefinition Width="Auto" />
                            <ColumnDefinition Width="Auto" />
                            <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>

                        <TextBlock
                            Grid.Row="0"
                            Grid.Column="2"
                            Margin="3,0,0,0"
                            Text="Кол-во:" />
                        <TextBlock
                            Grid.Row="0"
                            Grid.Column="3"
                            Margin="3,0,0,0"
                            Text="Ед. изм:" />
                        <TextBlock
                            Grid.Row="0"
                            Grid.Column="4"
                            Margin="0,0,0,3"
                            Text="Выбрать обвязку" />

                        <!--  Тип обвязки  -->
                        <TextBlock
                            Grid.Row="0"
                            Grid.Column="0"
                            Text="Тип обвязки:" />
                        <TextBox
                            Grid.Row="0"
                            Grid.Column="1"
                            Margin="0,0,5,5"
                            Text="{Binding CurrentProjectModel.SelectedStand.ObvyazkaName}" />
                        <Button
                            Grid.Row="0"
                            Grid.Column="5"
                            Width="24"
                            Margin="0,0,0,5"
                            Command="{Binding ProjectCommandProvider.SelectObvFromDialogCommand}"
                            Content="..." />
                        <TextBlock
                            Grid.Row="0"
                            Grid.Column="6"
                            Margin="2,2,7,7"
                            Text="NN:" />
                        <TextBox
                            Grid.Row="0"
                            Grid.Column="7"
                            Width="30"
                            Margin="5,5,5,5"
                            Text="{Binding CurrentProjectModel.SelectedStand.NN}" />

                        <!--  Материал линии  -->
                        <TextBlock
                            Grid.Row="1"
                            Grid.Column="0"
                            Text="Материал линии:" />
                        <TextBox
                            Grid.Row="1"
                            Grid.Column="1"
                            Margin="0,0,5,5"
                            Text="{Binding CurrentProjectModel.SelectedStand.MaterialLine}" />
                        <TextBox
                            Grid.Row="1"
                            Grid.Column="2"
                            Width="50"
                            Margin="0,0,5,5"
                            Text="{Binding CurrentProjectModel.SelectedStand.MaterialLineCount}"
                            ToolTip="Количество материала линии" />
                        <TextBox
                            Grid.Row="1"
                            Grid.Column="3"
                            Width="50"
                            Margin="0,0,5,5"
                            Text="{Binding CurrentProjectModel.SelectedStand.MaterialLineMeasure}"
                            ToolTip="Ед. измерения" />
                        <ComboBox
                            Grid.Row="1"
                            Grid.Column="4"
                            Width="120"
                            Margin="0,0,5,5"
                            ItemsSource="{Binding CurrentMaterials.MaterialLineTypes}"
                            SelectedItem="{Binding CurrentMaterials.SelectedMaterialLine, Mode=TwoWay}" />
                        <Button
                            Grid.Row="1"
                            Grid.Column="5"
                            Width="24"
                            Margin="5,0,5,5"
                            Command="{Binding ProjectCommandProvider.SelectMaterialLineDialogCommand}"
                            Content="..." />

                        <!--  Арматура  -->
                        <TextBlock
                            Grid.Row="2"
                            Grid.Column="0"
                            Text="Арматура:" />
                        <TextBox
                            Grid.Row="2"
                            Grid.Column="1"
                            Margin="0,0,5,5"
                            Text="{Binding CurrentProjectModel.SelectedStand.Armature}" />
                        <TextBox
                            Grid.Row="2"
                            Grid.Column="2"
                            Width="50"
                            Margin="0,0,5,5"
                            Text="{Binding CurrentProjectModel.SelectedStand.ArmatureCount}"
                            ToolTip="Количество арматуры" />
                        <TextBox
                            Grid.Row="2"
                            Grid.Column="3"
                            Width="50"
                            Margin="0,0,5,5"
                            Text="{Binding CurrentProjectModel.SelectedStand.ArmatureMeasure}"
                            ToolTip="Ед. измерения" />
                        <ComboBox
                            Grid.Row="2"
                            Grid.Column="4"
                            Width="120"
                            Margin="0,0,5,5"
                            ItemsSource="{Binding CurrentMaterials.AramuteresTypes}"
                            SelectedItem="{Binding CurrentMaterials.SelectedAramuteres, Mode=TwoWay}" />
                        <Button
                            Grid.Row="2"
                            Grid.Column="5"
                            Width="24"
                            Margin="5,0,5,5"
                            Command="{Binding ProjectCommandProvider.SelectArmatureDialogCommand}"
                            Content="..." />

                        <!--  Тройник  -->
                        <TextBlock
                            Grid.Row="3"
                            Grid.Column="0"
                            Text="Тройник:" />
                        <TextBox
                            Grid.Row="3"
                            Grid.Column="1"
                            Margin="0,0,5,5"
                            Text="{Binding CurrentProjectModel.SelectedStand.TreeSocket}" />
                        <TextBox
                            Grid.Row="3"
                            Grid.Column="2"
                            Width="50"
                            Margin="0,0,5,5"
                            Text="{Binding CurrentProjectModel.SelectedStand.TreeSocketMaterialCount}"
                            ToolTip="Количество тройников" />
                        <TextBox
                            Grid.Row="3"
                            Grid.Column="3"
                            Width="50"
                            Margin="0,0,5,5"
                            Text="{Binding CurrentProjectModel.SelectedStand.TreeSocketMaterialMeasure}"
                            ToolTip="Ед. измерения" />
                        <ComboBox
                            Grid.Row="3"
                            Grid.Column="4"
                            Width="120"
                            Margin="0,0,5,5"
                            ItemsSource="{Binding CurrentMaterials.TreeSocketTypes}"
                            SelectedItem="{Binding CurrentMaterials.SelectedSocketTypes, Mode=TwoWay}" />
                        <Button
                            Grid.Row="3"
                            Grid.Column="5"
                            Width="24"
                            Margin="5,0,5,5"
                            Command="{Binding ProjectCommandProvider.SelectTreeSocketDialogCommand}"
                            Content="..." />

                        <!--  КМЧ  -->
                        <TextBlock
                            Grid.Row="4"
                            Grid.Column="0"
                            Text="КМЧ:" />
                        <TextBox
                            Grid.Row="4"
                            Grid.Column="1"
                            Margin="0,0,5,0"
                            Text="{Binding CurrentProjectModel.SelectedStand.KMCH}" />
                        <TextBox
                            Grid.Row="4"
                            Grid.Column="2"
                            Width="50"
                            Margin="0,0,5,0"
                            Text="{Binding CurrentProjectModel.SelectedStand.KMCHCount}"
                            ToolTip="Количество КМЧ" />
                        <TextBox
                            Grid.Row="4"
                            Grid.Column="3"
                            Width="50"
                            Margin="0,0,5,0"
                            Text="{Binding CurrentProjectModel.SelectedStand.KMCHMeasure}"
                            ToolTip="Ед. измерения" />
                        <ComboBox
                            Grid.Row="4"
                            Grid.Column="4"
                            Width="120"
                            Margin="0,0,5,0"
                            ItemsSource="{Binding CurrentMaterials.KMCHTypes}"
                            SelectedItem="{Binding CurrentMaterials.SelectedKMCHType, Mode=TwoWay}" />
                        <Button
                            Grid.Row="4"
                            Grid.Column="5"
                            Width="24"
                            Command="{Binding ProjectCommandProvider.SelectKMCHDialogCommand}"
                            Content="..." />
                    </Grid>

                    <!--  right: preview — не входит в layout строк формы, поэтому не растягивает их  -->
                    <Border
                        Grid.Column="1"
                        Margin="8,0,0,0"
                        Padding="6"
                        HorizontalAlignment="Right"
                        VerticalAlignment="Top"
                        Background="WhiteSmoke"
                        BorderBrush="LightGray"
                        BorderThickness="1"
                        CornerRadius="4">
                        <Image
                            MaxWidth="200"
                            MaxHeight="200"
                            VerticalAlignment="Top"
                            Source="{Binding CurrentProjectModel.SelectedStand.SelectedObvyazkaInStand.ImageName, Converter={StaticResource ObvyazkaImagePathConverter}}"
                            Stretch="Uniform"
                            ToolTip="Изображение обвязки" />
                    </Border>
                </Grid>
            </GroupBox>

            <!--  Датчик 1  -->
            <GroupBox
                Grid.Row="1"
                Margin="0,0,0,10"
                Padding="8"
                Header="Датчик 1">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                    </Grid.RowDefinitions>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="*" />
                    </Grid.ColumnDefinitions>

                    <TextBlock
                        Grid.Row="0"
                        Grid.Column="0"
                        Text="Тип датчика:" />
                    <ComboBox
                        Grid.Row="0"
                        Grid.Column="1"
                        Margin="0,0,600,5"
                        ItemsSource="{Binding CurrentProjectModel.SelectedStand.SensorType}"
                        SelectedIndex="1"
                        SelectedItem="{Binding CurrentProjectModel.SelectedStand.FirstSensorType, Mode=TwoWay}" />

                    <TextBlock
                        Grid.Row="1"
                        Grid.Column="0"
                        Text="KKS-контура:" />
                    <TextBox
                        Grid.Row="1"
                        Grid.Column="1"
                        Margin="0,0,5,5"
                        Text="{Binding CurrentProjectModel.SelectedStand.FirstSensorKKSCounter}" />

                    <TextBlock
                        Grid.Row="2"
                        Grid.Column="0"
                        Text="Маркировка (+):" />
                    <TextBox
                        Grid.Row="2"
                        Grid.Column="1"
                        Margin="0,0,5,5"
                        Text="{Binding CurrentProjectModel.SelectedStand.FirstSensorMarkPlus}" />

                    <TextBlock
                        Grid.Row="3"
                        Grid.Column="0"
                        Text="Маркировка (-):" />
                    <TextBox
                        Grid.Row="3"
                        Grid.Column="1"
                        Margin="0,0,5,5"
                        Text="{Binding CurrentProjectModel.SelectedStand.FirstSensorMarkMinus}" />

                    <TextBlock
                        Grid.Row="4"
                        Grid.Column="0"
                        Text="Описание:" />
                    <TextBox
                        Grid.Row="4"
                        Grid.Column="1"
                        Height="40"
                        Margin="0,0,5,0"
                        AcceptsReturn="True"
                        Text="{Binding CurrentProjectModel.SelectedStand.Sensor1.Description}"
                        TextWrapping="Wrap" />
                </Grid>
            </GroupBox>

            <!--  остальные части формы без изменений  -->
            <GroupBox
                Grid.Row="2"
                Margin="0,0,0,10"
                Padding="8"
                Header="Датчик 2">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                    </Grid.RowDefinitions>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="*" />
                    </Grid.ColumnDefinitions>

                    <TextBlock
                        Grid.Row="0"
                        Grid.Column="0"
                        Text="Тип датчика:" />
                    <ComboBox
                        Grid.Row="0"
                        Grid.Column="1"
                        Margin="0,0,600,5"
                        ItemsSource="{Binding CurrentProjectModel.SelectedStand.SensorType}"
                        SelectedItem="{Binding CurrentProjectModel.SelectedStand.SecondSensorType}" />

                    <TextBlock
                        Grid.Row="1"
                        Grid.Column="0"
                        Text="KKS-контура:" />
                    <TextBox
                        Grid.Row="1"
                        Grid.Column="1"
                        Margin="0,0,5,5"
                        Text="{Binding CurrentProjectModel.SelectedStand.SecondSensorKKS}" />

                    <TextBlock
                        Grid.Row="2"
                        Grid.Column="0"
                        Text="Маркировка (+):" />
                    <TextBox
                        Grid.Row="2"
                        Grid.Column="1"
                        Margin="0,0,5,5"
                        Text="{Binding CurrentProjectModel.SelectedStand.SecondSensorMarkPlus}" />

                    <TextBlock
                        Grid.Row="3"
                        Grid.Column="0"
                        Text="Маркировка (-):" />
                    <TextBox
                        Grid.Row="3"
                        Grid.Column="1"
                        Margin="0,0,5,5"
                        Text="{Binding CurrentProjectModel.SelectedStand.SecondSensorMarkMinus}" />

                    <TextBlock
                        Grid.Row="4"
                        Grid.Column="0"
                        Text="Описание:" />
                    <TextBox
                        Grid.Row="4"
                        Grid.Column="1"
                        Height="40"
                        Margin="0,0,5,0"
                        AcceptsReturn="True"
                        Text="{Binding CurrentProjectModel.SelectedStand.Sensor2.Description}"
                        TextWrapping="Wrap" />
                </Grid>
            </GroupBox>

            <GroupBox
                Grid.Row="3"
                Margin="0,0,0,10"
                Padding="8"
                Header="Датчик 3">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                    </Grid.RowDefinitions>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="*" />
                    </Grid.ColumnDefinitions>

                    <TextBlock
                        Grid.Row="0"
                        Grid.Column="0"
                        Text="Тип датчика:" />
                    <ComboBox
                        Grid.Row="0"
                        Grid.Column="1"
                        Margin="0,0,600,5"
                        ItemsSource="{Binding CurrentProjectModel.SelectedStand.SensorType}"
                        SelectedItem="{Binding CurrentProjectModel.SelectedStand.ThirdSensorType}" />

                    <TextBlock
                        Grid.Row="1"
                        Grid.Column="0"
                        Text="KKS-контура:" />
                    <TextBox
                        Grid.Row="1"
                        Grid.Column="1"
                        Margin="0,0,5,5"
                        Text="{Binding CurrentProjectModel.SelectedStand.ThirdSensorKKS}" />

                    <TextBlock
                        Grid.Row="2"
                        Grid.Column="0"
                        Text="Маркировка (+):" />
                    <TextBox
                        Grid.Row="2"
                        Grid.Column="1"
                        Margin="0,0,5,5"
                        Text="{Binding CurrentProjectModel.SelectedStand.ThirdSensorMarkPlus}" />

                    <TextBlock
                        Grid.Row="3"
                        Grid.Column="0"
                        Text="Маркировка (-):" />
                    <TextBox
                        Grid.Row="3"
                        Grid.Column="1"
                        Margin="0,0,5,5"
                        Text="{Binding CurrentProjectModel.SelectedStand.ThirdSensorMarkMinus}" />

                    <TextBlock
                        Grid.Row="4"
                        Grid.Column="0"
                        Text="Описание:" />
                    <TextBox
                        Grid.Row="4"
                        Grid.Column="1"
                        Height="40"
                        Margin="0,0,5,0"
                        AcceptsReturn="True"
                        Text="{Binding CurrentProjectModel.SelectedStand.Sensor3.Description}"
                        TextWrapping="Wrap" />
                </Grid>
            </GroupBox>

            <!--  Список обвязок остался в правой панели (под списком стендов)  -->
            <StackPanel
                Grid.Row="5"
                Margin="0,10,0,0"
                HorizontalAlignment="Right">
                <Button
                    Width="120"
                    Height="30"
                    Command="{Binding ProjectCommandProvider.SaveObvCommand}"
                    Content="Добавить" />
            </StackPanel>
        </Grid>

        <!--  Правая панель: список стендов + обвязки под ним  -->
        <Border
            Grid.Column="1"
            Margin="0,0,0,0"
            BorderBrush="#DDDDDD"
            BorderThickness="1">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="*" />
                    <RowDefinition Height="*" />
                </Grid.RowDefinitions>
                <TextBlock
                    Grid.Row="0"
                    Margin="5"
                    FontWeight="Bold"
                    Text="Список стендов проекта" />
                <ListView
                    Grid.Row="1"
                    Margin="5,0,5,5"
                    ItemsSource="{Binding CurrentProjectModel.Stands}"
                    SelectedItem="{Binding CurrentProjectModel.SelectedStand, Mode=TwoWay}">
                    <ListView.View>
                        <GridView>
                            <GridViewColumn
                                Width="40"
                                DisplayMemberBinding="{Binding Number}"
                                Header="№" />
                            <GridViewColumn
                                Width="120"
                                DisplayMemberBinding="{Binding KKSCode}"
                                Header="KKS" />
                            <GridViewColumn
                                Width="200"
                                DisplayMemberBinding="{Binding Design}"
                                Header="Обозначение" />
                        </GridView>
                    </ListView.View>
                </ListView>
                <GroupBox
                    Grid.Row="2"
                    Margin="5,5,5,5"
                    Padding="5"
                    Header="Обвязки стенда">
                    <ListView ItemsSource="{Binding CurrentProjectModel.SelectedStand.ObvyazkiInStand}" SelectedItem="{Binding CurrentProjectModel.SelectedStand.SelectedObvyazkaInStand}">
                        <ListView.View>
                            <GridView>
                                <GridViewColumn
                                    Width="100"
                                    DisplayMemberBinding="{Binding ObvyazkaName}"
                                    Header="Тип" />
                                <GridViewColumn
                                    Width="120"
                                    DisplayMemberBinding="{Binding MaterialLine}"
                                    Header="Материал" />
                                <GridViewColumn
                                    Width="100"
                                    DisplayMemberBinding="{Binding Armature}"
                                    Header="Арматура" />
                                <GridViewColumn
                                    Width="100"
                                    DisplayMemberBinding="{Binding TreeSocket}"
                                    Header="Тройник" />
                                <GridViewColumn
                                    Width="100"
                                    DisplayMemberBinding="{Binding KMCH}"
                                    Header="КМЧ" />
                                <GridViewColumn
                                    Width="100"
                                    DisplayMemberBinding="{Binding FirstSensorType}"
                                    Header="Датчик 1" />
                                <GridViewColumn
                                    Width="100"
                                    DisplayMemberBinding="{Binding WidthOnFrame}"
                                    Header="Ширина на раме" />
                                <GridViewColumn
                                    Width="100"
                                    DisplayMemberBinding="{Binding HumanCost}"
                                    Header="Трудозатраты" />
                            </GridView>
                        </ListView.View>
                        <ListView.ContextMenu>
                            <ContextMenu>
                                <MenuItem Command="{Binding ProjectCommandProvider.RemoveObvFromStandCommand}" Header="Удалить обвязку из стенда" />
                                <MenuItem Header="Копировать обвязку" />
                            </ContextMenu>
                        </ListView.ContextMenu>
                    </ListView>
                </GroupBox>
            </Grid>
        </Border>
    </Grid>
</UserControl>