<UserControl
    x:Class="ReportEngine.App.Views.Controls.StandsContainerView"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    Background="{DynamicResource PrimaryColor}"
    FontSize="16"
    Foreground="{DynamicResource PrimaryForeground}"
    mc:Ignorable="d">
    <Grid Margin="6">
        <Grid.RowDefinitions>
            <RowDefinition Height="*" />
            <RowDefinition Height="150" />
        </Grid.RowDefinitions>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="*" />
            <ColumnDefinition Width="*" />
            <ColumnDefinition Width="*" />
        </Grid.ColumnDefinitions>

        <!--  Partitions / Batches  -->
        <GroupBox
            Grid.Row="0"
            Grid.Column="0"
            Margin="5"
            Padding="5"
            Header="Упаковки проекта">
            <DockPanel LastChildFill="True">
                <!--  Убраны кнопки сверху. Управление через контекстное меню на DataGrid  -->
                <DataGrid
                    AutoGenerateColumns="False"
                    CanUserAddRows="True"
                    CanUserDeleteRows="True"
                    ItemsSource="{Binding CurrentProjectModel.ContainerBatchesInProject}"
                    SelectedItem="{Binding CurrentProjectModel.SelectedContainerBatch}">
                    <DataGrid.ContextMenu>
                        <ContextMenu>
                            <MenuItem Command="{Binding ProjectCommandProvider.CreateContainerBatchCommand}" Header="Добавить очередь" />
                            <Separator />
                            <MenuItem Command="{Binding ProjectCommandProvider.RefreshBatchesCommand}" Header="Обновить список" />
                            <Separator />
                            <MenuItem Command="{Binding ProjectCommandProvider.DeleteBatchCommand}" Header="Удалить упаковку проекта" />
                        </ContextMenu>
                    </DataGrid.ContextMenu>
                    <DataGrid.Columns>
                        <DataGridTextColumn
                            Width="80"
                            Binding="{Binding BatchOrder}"
                            Header="№" />
                        <DataGridTextColumn
                            Width="120"
                            Binding="{Binding ContainersCount}"
                            Header="Количество тары" />
                        <DataGridTextColumn
                            Width="100"
                            Binding="{Binding StandsCount}"
                            Header="Количество стендов" />
                    </DataGrid.Columns>
                </DataGrid>
            </DockPanel>
        </GroupBox>

        <!--  Containers in selected batch  -->
        <GroupBox
            Grid.Row="0"
            Grid.Column="1"
            Margin="5"
            Padding="5">
            <GroupBox.Header>
                <TextBlock>
                    <Run Text="Упаковка №" />
                    <Run
                        FontSize="14"
                        FontWeight="Bold"
                        Text="{Binding CurrentProjectModel.SelectedContainerBatch.BatchOrder, TargetNullValue='(ошибка привязки)'}" />
                </TextBlock>
            </GroupBox.Header>
            <DockPanel LastChildFill="True">
                <!--  Поля для ввода оставлены для быстрого создания, но можно добавлять строки прямо в DataGrid  -->

                <DataGrid
                    CanUserAddRows="True"
                    CanUserDeleteRows="True"
                    IsReadOnly="False"
                    ItemsSource="{Binding CurrentProjectModel.ContainerStandsInSelectedBatch}"
                    SelectedItem="{Binding CurrentProjectModel.SelectedContainerStand}">
                    <DataGrid.ContextMenu>
                        <ContextMenu>
                            <MenuItem Command="{Binding ProjectCommandProvider.AddContainerToBatchCommand}" Header="Добавить упаковку в очередь" />
                            <MenuItem Command="{Binding ProjectCommandProvider.DeleteContainerCommand}" Header="Удалить упаковку" />
                        </ContextMenu>
                    </DataGrid.ContextMenu>
                    <DataGrid.Columns>
                        <DataGridTextColumn Binding="{Binding Name}" Header="Тара" />
                        <DataGridTextColumn
                            Width="120"
                            Binding="{Binding StandsCount}"
                            Header="Количество стендов" />
                        <DataGridTextColumn
                            Width="120"
                            Binding="{Binding StandsWeight}"
                            Header="Масса стендов" />
                        <DataGridTextColumn
                            Width="120"
                            Binding="{Binding ContainerWeight}"
                            Header="Масса" />
                        <DataGridTextColumn
                            Width="120"
                            Binding="{Binding ContainerCost}"
                            Header="Стоимость" />
                        <DataGridTemplateColumn Header="Выбрать">
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <Button
                                        Margin="2,0,2,0"
                                        Padding="5,0,5,0"
                                        Command="{Binding DataContext.ProjectCommandProvider.OpenAllSortamentsDialogCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                        CommandParameter="{Binding}"
                                        Content="Выбрать" />
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>
                        </DataGridTemplateColumn>
                    </DataGrid.Columns>
                </DataGrid>
            </DockPanel>
        </GroupBox>

        <!--  Stands in selected container and project stands to pick from  -->
        <GroupBox
            Grid.Row="0"
            Grid.Column="2"
            Margin="5"
            Padding="5"
            Header="Стенды">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="*" />
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="*" />
                </Grid.RowDefinitions>

                <GroupBox
                    Grid.Row="0"
                    Margin="4"
                    Header="Стенды внутри тары">
                    <DataGrid
                        Margin="4,24,4,4"
                        AutoGenerateColumns="False"
                        IsReadOnly="True"
                        ItemsSource="{Binding CurrentProjectModel.StandsInSelectedContainer}"
                        SelectedItem="{Binding CurrentProjectModel.SelectedStandInContainer}">
                        <DataGrid.ContextMenu>
                            <ContextMenu>
                                <MenuItem Command="{Binding ProjectCommandProvider.RemoveStandFromContainerCommand}" Header="Удалить стенд из упаковки" />
                            </ContextMenu>
                        </DataGrid.ContextMenu>
                        <DataGrid.Columns>
                            <DataGridTextColumn Binding="{Binding KKSCode}" Header="KKS" />
                            <DataGridTextColumn
                                Width="140"
                                Binding="{Binding SerialNumber}"
                                Header="Серийный номер" />
                            <DataGridTextColumn
                                Width="100"
                                Binding="{Binding Width}"
                                Header="Ширина" />
                        </DataGrid.Columns>
                    </DataGrid>
                </GroupBox>

                <StackPanel
                    Grid.Row="1"
                    Margin="0,6"
                    HorizontalAlignment="Center"
                    Orientation="Horizontal">
                    <!--  Кнопки убраны: добавление стенда делается через контекстное меню на списке стендов проекта  -->
                </StackPanel>

                <GroupBox
                    Grid.Row="2"
                    Margin="4"
                    Header="Стенды проекта">
                    <DataGrid
                        AutoGenerateColumns="False"
                        CanUserAddRows="False"
                        ItemsSource="{Binding CurrentProjectModel.Stands}"
                        SelectedItem="{Binding CurrentProjectModel.SelectedStandInProject}">
                        <DataGrid.ContextMenu>
                            <ContextMenu>
                                <MenuItem Command="{Binding ProjectCommandProvider.AddStandToContainerCommand}" Header="Добавить выбранный стенд в контейнер" />
                            </ContextMenu>
                        </DataGrid.ContextMenu>

                        <DataGrid.Columns>
                            <DataGridTextColumn Binding="{Binding KKSCode}" Header="KKS" />
                            <DataGridTextColumn
                                Width="140"
                                Binding="{Binding SerialNumber}"
                                Header="Серийный номер" />
                            <DataGridTextColumn
                                Width="80"
                                Binding="{Binding NN}"
                                Header="Ширина" />
                        </DataGrid.Columns>
                    </DataGrid>
                </GroupBox>
            </Grid>
        </GroupBox>
    </Grid>
</UserControl>